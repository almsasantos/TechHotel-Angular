<!DOCTYPE html>
<head>
    <title>OSM OAuth</title>
</head>
<body>
    <button id='authenticate'>Authenticate</button>
    <script type="text/javascript" src="sha.js"></script>
    <script type="text/javascript" src="ohauth.js"></script>
    <script>
var id = 'c602a8bd54b1e774f864';
    document.getElementById('authenticate').onclick = function() {
            var w = 600, h = 550,
            settings = [
                ['width', w], ['height', h],
                ['left', screen.width / 2 - w / 2],
                ['top', screen.height / 2 - h / 2]].map(function(x) {
                    return x.join('=');
                }).join(','),
            popup = window.open("about:blank", 'oauth_window', settings);
            popup.location = 'https://github.com/login/oauth/authorize?' + ohauth.qsString({
                client_id: id,
                scope: 'gist'
            });
    };
    function authComplete(x) {
        var code = x.split('=')[1];
            console.log(x, code);
       ohauth.rawxhr('GET', 'http://prose-gatekeeper.heroku.com/authenticate/' + code, null, null, function(err, resp) {
           console.log(arguments);
       });
            /*
        ohauth.rawxhr('POST', 'https://github.com/login/oauth/access_token?' + ohauth.qsString({
                client_id: id,
                client_secret: secret,
                code: code
            }), null, {
                'Accept': 'application/vnd.github.raw',
                // 'Authorization': 'token ' + code
            }, function(err, resp) {
            console.log(err.response);
            console.log(code);

            var g = {
                "description": "the description for this gist",
                "public": true,
                "files": {
                "file1.txt": {
                    "content": "String file contents"
                }
                }
            };
            ohauth.rawxhr('POST', 'https://api.github.com/gists',
                JSON.stringify(g), {
                    'Content-Type': 'application/json',
                    'Authorization': 'token ' + code,
                    'Accept': 'application/vnd.github.raw'
            }, function() {
                console.log(arguments);
            });
            });
            */
    }
    </script>
</body>
</HTML>


